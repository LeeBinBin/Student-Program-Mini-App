<view class="container">
  <view class="top-nav">
    <view class="nav-back" bindtap="navigateBack">
      <text class="back-icon">â†</text>
    </view>
    <view class="nav-title">å­¦ä¹ è¿›åº¦</view>
    <view class="nav-placeholder"></view>
  </view>

  <view class="content-container">
    <view class="student-info">
      <view class="student-avatar">
        <text class="avatar-icon">ğŸ“</text>
      </view>
      <view class="student-details">
        <view class="student-name">{{student.name}}</view>
        <view class="student-meta">
          <text class="meta-item">{{student.id}}</text>
          <text class="meta-divider">|</text>
          <text class="meta-item">{{student.school}}</text>
          <text class="meta-divider">|</text>
          <text class="meta-item">{{student.grade}}</text>
        </view>
      </view>
    </view>

    <view class="progress-section">
      <view class="section-header">
        <view class="section-title">ç§‘ç›®è¿›åº¦</view>
        <view class="add-progress-btn" bindtap="showAddProgressModal">
          <text class="add-icon">+</text>
          <text class="add-text">æ·»åŠ è®°å½•</text>
        </view>
      </view>

      <view class="subject-progress-list">
        <view wx:for="{{progressData}}" wx:key="id" class="subject-progress-item">
          <view class="subject-header">
            <view class="subject-info">
              <text class="subject-name">{{item.subject}}</text>
              <text class="subject-date">{{item.date}}</text>
            </view>
            <view class="progress-actions">
              <view class="action-icon" bindtap="editProgress" data-id="{{item.id}}">
                <text>âœ</text>
              </view>
              <view class="action-icon delete" bindtap="deleteProgress" data-id="{{item.id}}">
                <text>ğŸ—‘</text>
              </view>
            </view>
          </view>
          
          <view class="progress-content">
            <view class="progress-item">
              <text class="progress-label">å®Œæˆåº¦ï¼š</text>
              <view class="progress-bar">
                <view class="progress-fill" style="width: {{item.completion}}%"></view>
              </view>
              <text class="progress-value">{{item.completion}}%</text>
            </view>
            
            <view class="progress-item">
              <text class="progress-label">æŒæ¡ç¨‹åº¦ï¼š</text>
              <view class="mastery-level {{item.masteryLevel}}">
                <text class="mastery-text">{{item.masteryText}}</text>
              </view>
            </view>

            <view class="progress-item">
              <text class="progress-label">å¤‡æ³¨ï¼š</text>
              <text class="progress-remark">{{item.remark || 'æš‚æ— å¤‡æ³¨'}}</text>
            </view>
          </view>
        </view>
      </view>

      <view wx:if="{{progressData.length === 0}}" class="empty-state">
        <text class="empty-icon">ğŸ“Š</text>
        <view class="empty-text">æš‚æ— å­¦ä¹ è¿›åº¦è®°å½•</view>
        <view class="empty-desc">ç‚¹å‡»å³ä¸Šè§’æ·»åŠ è®°å½•</view>
      </view>
    </view>

    <view class="stats-section">
      <view class="section-title">å­¦ä¹ ç»Ÿè®¡</view>
      <view class="stats-grid">
        <view class="stat-item">
          <view class="stat-value">{{stats.totalSubjects}}</view>
          <view class="stat-label">å­¦ä¹ ç§‘ç›®</view>
        </view>
        <view class="stat-item">
          <view class="stat-value">{{stats.totalRecords}}</view>
          <view class="stat-label">è®°å½•æ€»æ•°</view>
        </view>
        <view class="stat-item">
          <view class="stat-value">{{stats.avgCompletion}}%</view>
          <view class="stat-label">å¹³å‡å®Œæˆåº¦</view>
        </view>
        <view class="stat-item">
          <view class="stat-value">{{stats.masteryCount}}</view>
          <view class="stat-label">å·²æŒæ¡</view>
        </view>
      </view>
    </view>
  </view>

  <view wx:if="{{showModal}}" class="modal" catchtap="hideModal">
    <view class="modal-content" catchtap="catchTap">
      <view class="modal-header">
        <view class="modal-title">{{modalTitle}}</view>
        <view class="modal-close" bindtap="hideModal">Ã—</view>
      </view>
      <view class="modal-body">
        <view class="form-item">
          <view class="form-label">ç§‘ç›® <text class="required">*</text></view>
          <picker mode="selector" range="{{subjectOptions}}" bindchange="onSubjectChange">
            <view class="picker-input">
              {{progressForm.subject || 'è¯·é€‰æ‹©ç§‘ç›®'}}
              <text class="picker-arrow">â–¼</text>
            </view>
          </picker>
        </view>

        <view class="form-item">
          <view class="form-label">å®Œæˆåº¦ <text class="required">*</text></view>
          <slider class="progress-slider" min="0" max="100" value="{{progressForm.completion}}" bindchange="onCompletionChange" show-value activeColor="#3B82F6" />
        </view>

        <view class="form-item">
          <view class="form-label">æŒæ¡ç¨‹åº¦ <text class="required">*</text></view>
          <view class="mastery-selector">
            <view class="mastery-option {{progressForm.masteryLevel === 'excellent' ? 'active' : ''}}" bindtap="onMasteryChange" data-level="excellent">
              <text class="mastery-icon">â­â­â­</text>
              <text class="mastery-label">ä¼˜ç§€</text>
            </view>
            <view class="mastery-option {{progressForm.masteryLevel === 'good' ? 'active' : ''}}" bindtap="onMasteryChange" data-level="good">
              <text class="mastery-icon">â­â­</text>
              <text class="mastery-label">è‰¯å¥½</text>
            </view>
            <view class="mastery-option {{progressForm.masteryLevel === 'average' ? 'active' : ''}}" bindtap="onMasteryChange" data-level="average">
              <text class="mastery-icon">â­</text>
              <text class="mastery-label">ä¸€èˆ¬</text>
            </view>
          </view>
        </view>

        <view class="form-item">
          <view class="form-label">æ—¥æœŸ <text class="required">*</text></view>
          <picker mode="date" value="{{progressForm.date}}" bindchange="onDateChange">
            <view class="picker-input">
              {{progressForm.date || 'è¯·é€‰æ‹©æ—¥æœŸ'}}
              <text class="picker-arrow">â–¼</text>
            </view>
          </picker>
        </view>

        <view class="form-item">
          <view class="form-label">å¤‡æ³¨</view>
          <textarea class="form-textarea" placeholder="è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯" value="{{progressForm.remark}}" bindinput="onRemarkChange" maxlength="200"></textarea>
        </view>
      </view>
      <view class="modal-footer">
        <view class="modal-btn cancel" bindtap="hideModal">å–æ¶ˆ</view>
        <view class="modal-btn confirm" bindtap="submitProgress">ä¿å­˜</view>
      </view>
    </view>
  </view>
</view>
