<view class="container">
  <view class="top-nav">
    <view class="nav-back" bindtap="navigateBack">
      <text class="back-icon">â†</text>
    </view>
    <view class="nav-title">ç´ æä¸­å¿ƒ</view>
    <view class="nav-actions">
      <view class="action-item" bindtap="showUpload">
        <text class="action-icon">â•</text>
      </view>
    </view>
  </view>

  <view class="content-container">
    <view class="search-bar">
      <view class="search-input-wrapper">
        <text class="search-icon">ğŸ”</text>
        <input class="search-input" placeholder="æœç´¢æ•™å­¦ç´ æ..." value="{{searchKeyword}}" bindinput="onSearchInput" bindconfirm="onSearch" />
      </view>
    </view>

    <view class="category-tabs">
      <view wx:for="{{categories}}" wx:key="id" class="category-tab {{currentCategory === item.id ? 'active' : ''}}" bindtap="onCategoryChange" data-id="{{item.id}}">
        <text class="category-icon">{{item.icon}}</text>
        <text class="category-name">{{item.name}}</text>
      </view>
    </view>
    <view class="materials-list" style="padding: 0 24rpx;">
      <view wx:for="{{filteredMaterials}}" wx:key="id" class="material-item" bindtap="viewMaterialDetail" data-id="{{item.id}}">
        <view class="material-icon">{{item.icon}}</view>
        <view class="material-info">
          <view class="material-title">{{item.title}}</view>
          <view class="material-meta">
            <text class="meta-tag">{{item.categoryName}}</text>
            <text class="meta-divider">|</text>
            <text class="meta-text">{{item.subject}}</text>
            <text class="meta-divider">|</text>
            <text class="meta-text">{{item.grade}}</text>
          </view>
          <view class="material-desc">{{item.description}}</view>
          <view class="material-footer">
            <text class="material-author">{{item.author}}</text>
            <text class="material-time">{{item.uploadTime}}</text>
            <text class="material-views">{{item.views}}æ¬¡æµè§ˆ</text>
          </view>
        </view>
        <view class="material-actions">
          <view class="action-btn download" bindtap="downloadMaterial" data-id="{{item.id}}" catchtap="stopPropagation">
            <text class="action-btn-icon">ğŸ“¥</text>
          </view>
          <view class="action-btn favorite" bindtap="toggleFavorite" data-id="{{item.id}}" catchtap="stopPropagation">
            <text class="action-btn-icon">{{item.isFavorite ? 'â¤ï¸' : 'ğŸ¤'}}</text>
          </view>
        </view>
      </view>
    </view>

    <view wx:if="{{filteredMaterials.length === 0}}" class="empty-state">
      <text class="empty-icon">ğŸ“</text>
      <text class="empty-text">æš‚æ— ç´ æ</text>
      <text class="empty-desc">ç‚¹å‡»å³ä¸Šè§’ä¸Šä¼ æ‚¨çš„æ•™å­¦ç´ æ</text>
    </view>
  </view>

  <view class="modal" wx:if="{{showUploadModal}}" bindtap="hideUploadModal">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <view class="modal-title">ä¸Šä¼ ç´ æ</view>
        <view class="modal-close" bindtap="hideUploadModal">Ã—</view>
      </view>
      <view class="modal-body">
        <view class="form-item">
          <view class="form-label">ç´ ææ ‡é¢˜ <text class="required">*</text></view>
          <input class="form-input" placeholder="è¯·è¾“å…¥ç´ ææ ‡é¢˜" value="{{uploadForm.title}}" bindinput="onUploadTitleChange" />
        </view>
        <view class="form-item">
          <view class="form-label">ç´ æç±»å‹ <text class="required">*</text></view>
          <picker class="form-picker" mode="selector" range="{{uploadCategories}}" range-key="name" value="{{uploadCategoryIndex}}" bindchange="onUploadCategoryChange">
            <view class="picker-value">{{uploadCategories[uploadCategoryIndex].name}}</view>
            <text class="picker-arrow">â–¼</text>
          </picker>
        </view>
        <view class="form-item">
          <view class="form-label">å­¦ç§‘ <text class="required">*</text></view>
          <picker class="form-picker" mode="selector" range="{{subjects}}" value="{{uploadSubjectIndex}}" bindchange="onUploadSubjectChange">
            <view class="picker-value">{{subjects[uploadSubjectIndex]}}</view>
            <text class="picker-arrow">â–¼</text>
          </picker>
        </view>
        <view class="form-item">
          <view class="form-label">å¹´çº§ <text class="required">*</text></view>
          <picker class="form-picker" mode="selector" range="{{grades}}" value="{{uploadGradeIndex}}" bindchange="onUploadGradeChange">
            <view class="picker-value">{{grades[uploadGradeIndex]}}</view>
            <text class="picker-arrow">â–¼</text>
          </picker>
        </view>
        <view class="form-item">
          <view class="form-label">ç´ ææè¿°</view>
          <textarea class="form-textarea" placeholder="è¯·è¾“å…¥ç´ ææè¿°" value="{{uploadForm.description}}" bindinput="onUploadDescChange" maxlength="200" />
        </view>
        <view class="form-item">
          <view class="form-label">ä¸Šä¼ æ–‡ä»¶</view>
          <view class="upload-area" bindtap="chooseFile">
            <text class="upload-icon">ğŸ“¤</text>
            <text class="upload-text">ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</text>
            <text wx:if="{{uploadForm.fileName}}" class="upload-file-name">{{uploadForm.fileName}}</text>
          </view>
        </view>
      </view>
      <view class="modal-footer">
        <view class="modal-btn cancel" bindtap="hideUploadModal">å–æ¶ˆ</view>
        <view class="modal-btn confirm" bindtap="submitUpload">ä¸Šä¼ </view>
      </view>
    </view>
  </view>

  <view class="modal" wx:if="{{showDetailModal}}" bindtap="hideDetailModal">
    <view class="modal-content detail-modal" catchtap="stopPropagation">
      <view class="modal-header">
        <view class="modal-title">ç´ æè¯¦æƒ…</view>
        <view class="modal-close" bindtap="hideDetailModal">Ã—</view>
      </view>
      <view class="modal-body">
        <view class="detail-icon">{{currentMaterial.icon}}</view>
        <view class="detail-title">{{currentMaterial.title}}</view>
        <view class="detail-meta">
          <text class="detail-tag">{{currentMaterial.categoryName}}</text>
          <text class="detail-divider">|</text>
          <text class="detail-text">{{currentMaterial.subject}}</text>
          <text class="detail-divider">|</text>
          <text class="detail-text">{{currentMaterial.grade}}</text>
        </view>
        <view class="detail-desc">{{currentMaterial.description}}</view>
        <view class="detail-info">
          <view class="info-row">
            <text class="info-label">ä¸Šä¼ è€…ï¼š</text>
            <text class="info-value">{{currentMaterial.author}}</text>
          </view>
          <view class="info-row">
            <text class="info-label">ä¸Šä¼ æ—¶é—´ï¼š</text>
            <text class="info-value">{{currentMaterial.uploadTime}}</text>
          </view>
          <view class="info-row">
            <text class="info-label">æµè§ˆæ¬¡æ•°ï¼š</text>
            <text class="info-value">{{currentMaterial.views}}æ¬¡</text>
          </view>
          <view class="info-row">
            <text class="info-label">æ–‡ä»¶å¤§å°ï¼š</text>
            <text class="info-value">{{currentMaterial.fileSize}}</text>
          </view>
        </view>
      </view>
      <view class="modal-footer">
        <view class="modal-btn cancel" bindtap="hideDetailModal">å…³é—­</view>
        <view class="modal-btn confirm" bindtap="downloadMaterialFromDetail">ä¸‹è½½</view>
      </view>
    </view>
  </view>
</view>
