<view class="container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <view class="page-title">ä¸‰è¯­è¾…å¯¼èµ„æ–™</view>
  </view>

  <!-- åˆ†ç±»å¯¼èˆª -->
  <view class="filter-container">
    <!-- å­¦ç§‘æ ‡ç­¾ -->
    <view class="filter-tabs">
      <view class="tab-item {{currentSubject === 'å…¨éƒ¨' ? 'active' : ''}}" bindtap="switchSubject" data-subject="å…¨éƒ¨">å…¨éƒ¨</view>
      <view class="tab-item {{currentSubject === 'è¯­æ–‡' ? 'active' : ''}}" bindtap="switchSubject" data-subject="è¯­æ–‡">è¯­æ–‡</view>
      <view class="tab-item {{currentSubject === 'æ•°å­¦' ? 'active' : ''}}" bindtap="switchSubject" data-subject="æ•°å­¦">æ•°å­¦</view>
      <view class="tab-item {{currentSubject === 'è‹±è¯­' ? 'active' : ''}}" bindtap="switchSubject" data-subject="è‹±è¯­">è‹±è¯­</view>
      <view class="tab-item {{currentSubject === 'ç‰©ç†' ? 'active' : ''}}" bindtap="switchSubject" data-subject="ç‰©ç†">ç‰©ç†</view>
      <view class="tab-item {{currentSubject === 'åŒ–å­¦' ? 'active' : ''}}" bindtap="switchSubject" data-subject="åŒ–å­¦">åŒ–å­¦</view>
      <view class="tab-item {{currentSubject === 'ç”Ÿç‰©' ? 'active' : ''}}" bindtap="switchSubject" data-subject="ç”Ÿç‰©">ç”Ÿç‰©</view>
    </view>

    <!-- ç­›é€‰æ¡ä»¶ -->
    <view class="filter-options">
      <view class="filter-item">
        <view class="filter-label">å¹´çº§</view>
        <view class="filter-picker">
          <picker bindchange="bindGradeChange" value="{{gradeIndex}}" range="{{grades}}">
            <view class="picker-text">{{grades[gradeIndex]}}</view>
          </picker>
        </view>
      </view>
      <view class="filter-item">
        <view class="filter-label">è¯­è¨€</view>
        <view class="filter-picker">
          <picker bindchange="bindLanguageChange" value="{{languageIndex}}" range="{{languages}}">
            <view class="picker-text">{{languages[languageIndex]}}</view>
          </picker>
        </view>
      </view>
      <view class="filter-item">
        <view class="filter-label">èµ„æ–™ç±»å‹</view>
        <view class="filter-picker">
          <picker bindchange="bindTypeChange" value="{{typeIndex}}" range="{{types}}">
            <view class="picker-text">{{types[typeIndex]}}</view>
          </picker>
        </view>
      </view>
      <view class="filter-btn" bindtap="filterMaterials">ç­›é€‰</view>
    </view>
  </view>

  <!-- èµ„æ–™åˆ—è¡¨ -->
  <view class="material-grid">
    <view wx:for="{{materials}}" wx:key="index" class="material-card">
      <view class="card-body">
        <view class="card-title">{{item.title}}</view>
        <view class="card-type {{getTypeClass(item.type)}}">{{item.type}}</view>
        <view class="card-desc">{{item.description}}</view>
        <view class="card-stats">
          <view class="stat-item">
            <text class="stat-icon">ğŸ‘ï¸</text>
            <text class="stat-text">{{item.views}}</text>
          </view>
          <view class="stat-item">
            <text class="stat-icon">ğŸ“¥</text>
            <text class="stat-text">{{item.downloads}}</text>
          </view>
        </view>
        <view class="card-actions">
          <view class="action-btn preview-btn" bindtap="previewMaterial" data-item="{{item}}">é¢„è§ˆ</view>
          <view class="action-btn download-btn" bindtap="downloadMaterial" data-item="{{item}}">ä¸‹è½½</view>
          <view wx:if="item.type === 'éŸ³é¢‘'" class="action-btn play-btn" bindtap="playAudio" data-item="{{item}}">æ’­æ”¾</view>
          <view class="action-btn favorite-btn" bindtap="toggleFavorite" data-item="{{item}}">
            <text>{{item.isFavorite ? 'å·²æ”¶è—' : 'æ”¶è—'}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view wx:if="{{materials.length === 0}}" class="empty-state">
    <image class="empty-icon" src="https://trae-api-cn.mchost.guru/api/ide/v1/text_to_image?prompt=Empty%20state%20icon%20for%20educational%20materials%2C%20simple%20line%20style%2C%20blue%20color%20scheme&image_size=square"></image>
    <view class="empty-text">æš‚æ— ç›¸å…³èµ„æ–™</view>
  </view>

  <!-- åˆ†é¡µ -->
  <view class="pagination" wx:if="{{materials.length > 0}}">
    <view class="pagination-item {{currentPage === 1 ? 'active' : ''}}" bindtap="goToPage" data-page="1">1</view>
    <view class="pagination-item" wx:if="{{currentPage > 2}}">...</view>
    <view class="pagination-item active" wx:if="{{currentPage > 1 && currentPage < totalPages}}">{{currentPage}}</view>
    <view class="pagination-item" bindtap="nextPage" wx:if="{{currentPage < totalPages}}">ä¸‹ä¸€é¡µ</view>
    <view class="pagination-item {{currentPage === totalPages ? 'active' : ''}}" bindtap="goToPage" data-page="{{totalPages}}" wx:if="{{totalPages > 1}}">{{totalPages}}</view>
  </view>
  
  <!-- è·³è½¬è¾“å…¥æ¡† -->
  <view class="pagination-jump-container" wx:if="{{materials.length > 0}}">
    <input class="pagination-input" type="number" placeholder="é¡µç " bindinput="onPageInput" value="{{jumpPage}}" />
    <view class="pagination-jump-btn" bindtap="jumpToPage">è·³è½¬</view>
  </view>

  <!-- éŸ³é¢‘æ’­æ”¾æ§ä»¶ -->
  <view class="audio-player" wx:if="{{showAudioPlayer}}">
    <view class="audio-info">
      <view class="audio-title">{{currentAudio.title}}</view>
      <view class="audio-progress">
        <view class="progress-bar">
          <view class="progress-fill" style="width: {{audioProgress}}"></view>
        </view>
        <view class="audio-time">{{formatTime(currentTime)}} / {{formatTime(duration)}}</view>
      </view>
    </view>
    <view class="audio-controls">
      <view class="control-btn" bindtap="togglePlay">
        <text class="control-icon">{{isPlaying ? 'â¸ï¸' : 'â–¶ï¸'}}</text>
      </view>
      <view class="control-btn" bindtap="hideAudioPlayer">
        <text class="control-icon">âœ•</text>
      </view>
    </view>
  </view>
</view>